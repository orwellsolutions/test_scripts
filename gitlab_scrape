import requests
import json
import os

# If the token is set in the environment, use it
access_token = os.getenv('GITLAB_ACCESS_TOKEN')

# If the token is not set in the environment, prompt for it
if access_token is None:
    access_token = input("Please enter your GitLab access token: ")

gitlab_url = 'https://gitlab.com/api/v4/projects'  # URL for GitLab's API for projects

# Define headers for the request
headers = {
    'Private-Token': access_token
}

page = 1
per_page = 100  # Maximum allowed by GitLab

while True:
    # Send GET request to GitLab's API
    response = requests.get(f'{gitlab_url}?page={page}&per_page={per_page}', headers=headers)

    # If request is successful
    if response.status_code == 200:
        # Parse the JSON response
        data = json.loads(response.text)

        # If data is empty, we are done
        if not data:
            break

        # Loop through each project in the response and print its name
        for project in data:
            print(project['name'])

        # Go to the next page
        page += 1
    else:
        print(f'Error: Unable to get the list of projects. Status code {response.status_code}')
        break
